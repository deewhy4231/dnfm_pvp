<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>3:3 대장전</title>
  <style>
    * { box-sizing:border-box; margin:0; padding:0; }
    body {
      background:#0f172a;
      color:#e5e7eb;
      font-family:Arial,"맑은 고딕",sans-serif;
      padding:20px;
    }

    h1 { text-align:center; margin-bottom:20px; }

    /* 상단 설정 영역 */
    .top-bar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:20px;
      flex-wrap:wrap;
      gap:10px;
    }
    .status { padding:10px 20px; background:#111827; border-radius:10px; }

    .config label { margin-right:8px; font-size:13px; }
    select { padding:5px 10px; background:#020617; color:#fff; border-radius:6px; }

    button {
      padding:10px 20px;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
    }
    .reset-btn { background:#ef4444; color:white; }
    .shuffle-btn { background:#4b5563; color:white; }

    /* 레이아웃 */
    .layout {
      display:grid;
      grid-template-columns:1.4fr 2fr 1.4fr;
      gap:16px;
    }

    .panel {
      background:#020617;
      border:1px solid #1f2937;
      border-radius:12px;
      padding:14px;
    }

    .team-name.blue { color:#60a5fa; font-size:20px; font-weight:800; }
    .team-name.red  { color:#f87171; font-size:20px; font-weight:800; }

    .ban-list, .pick-list {
      display:flex; flex-wrap:wrap; gap:6px;
      min-height:40px; margin-bottom:10px;
    }
    .chip {
      padding:4px 8px;
      font-size:12px;
      border-radius:999px;
      background:#1f2937;
      white-space:nowrap;
    }
    .chip.ban  { color:#fbbf24; border:1px solid #f59e0b; }
    .chip.pick { color:#4ade80; border:1px solid #22c55e; }

    /* 챔피언 리스트 */
    .champion-pool {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(100px,1fr));
      gap:10px;
      max-height:500px;
      overflow-y:auto;
    }
    .champion {
      text-align:center;
      background:#020617;
      border:1px solid #1f2937;
      border-radius:10px;
      padding:5px;
      cursor:pointer;
      transition:0.1s;
    }
    .champion img {
      width:100px; height:100px; object-fit:cover;
      border-radius:8px;
    }
    .champion.banned {
      opacity:0.3;
      border-style:dashed;
      cursor:not-allowed;
    }

    /* 전투 화면 */
    #battleArea { margin-top:40px; display:none; text-align:center; }

    .health-container {
      display:flex;
      justify-content:center;
      gap:40px;
      margin-bottom:20px;
    }

    .health-bar {
      display:flex;
      gap:5px;
    }

    .hp {
      width:50px;
      height:100px;
      border-radius:6px;
    }

    .hp.blue { background:#3b82f6; }
    .hp.red  { background:#ef4444; }

    .hp.lost { background:#111827; border:2px dashed #374151; }

    .battle-buttons button {
      padding:15px 40px;
      font-size:22px;
      margin:20px;
      border-radius:12px;
      border:3px solid #fff;
      background:transparent;
      cursor:pointer;
    }

    .battle-buttons button.blue { color:#3b82f6; border-color:#3b82f6; }
    .battle-buttons button.red  { color:#ef4444; border-color:#ef4444; }

    .big-win-text {
      font-size:80px;
      font-weight:900;
      color:#22c55e;
      text-shadow:0 0 20px rgba(0,0,0,0.8);
      margin-top:20px;
    }

    /* 라인업 영역 */
    .lineups {
      margin-top:20px;
      display:flex;
      justify-content:center;
      gap:60px;
    }
    .team-lineup-title {
      font-weight:800;
      margin-bottom:8px;
    }
    .team-lineup-title.blue { color:#60a5fa; }
    .team-lineup-title.red  { color:#f87171; }

    .lineup-cards {
      display:flex;
      gap:8px;
      justify-content:center;
    }
    .lineup-cards img {
      width:80px;
      height:80px;
      object-fit:cover;
      border-radius:10px;
      border:2px solid #e5e7eb;
    }
  </style>
</head>
<body>

<h1>3:3 대장전</h1>

<div class="top-bar">
  <div class="status" id="status"></div>

  <div class="config">
    <label>밴 개수
      <select id="banCount">
        <option value="0" selected>0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </label>

    <label>체력(레드)
      <select id="redHP">
        <option>1</option><option>2</option>
        <option>3</option><option>4</option>
        <option selected>5</option>
      </select>
    </label>

    <label>체력(블루)
      <select id="blueHP">
        <option>1</option><option>2</option>
        <option>3</option><option>4</option>
        <option selected>5</option>
      </select>
    </label>
  </div>

  <div>
    <button class="shuffle-btn" id="shuffleBtn">챔프 섞기</button>
    <button class="reset-btn" id="resetBtn">초기화</button>
  </div>
</div>

<!-- 밴픽 영역: LEFT=레드, RIGHT=블루 -->
<div class="layout" id="draftArea">
  <!-- 레드팀 (왼쪽) -->
  <div class="panel">
    <div class="team-name red">레드팀</div>
    <div class="ban-list" id="redBan"></div>
    <hr>
    <div class="pick-list" id="redPick"></div>
  </div>

  <div class="panel">
    <div style="text-align:center; font-weight:700;">챔피언 리스트</div>
    <div class="champion-pool" id="champPool"></div>
  </div>

  <!-- 블루팀 (오른쪽) -->
  <div class="panel">
    <div class="team-name blue">블루팀</div>
    <div class="ban-list" id="blueBan"></div>
    <hr>
    <div class="pick-list" id="bluePick"></div>
  </div>
</div>

<!-- 전투 + 라인업 화면 (LEFT=레드, RIGHT=블루) -->
<div id="battleArea">
  <h2>대장전 시작!</h2>

  <div class="lineups">
    <div>
      <div class="team-lineup-title red">레드 팀 라인업</div>
      <div class="lineup-cards" id="redLineup"></div>
    </div>
    <div>
      <div class="team-lineup-title blue">블루 팀 라인업</div>
      <div class="lineup-cards" id="blueLineup"></div>
    </div>
  </div>

  <div class="health-container">
    <div>
      <div style="color:#ef4444; font-weight:800;">RED HP</div>
      <div class="health-bar" id="redHPBar"></div>
    </div>

    <div>
      <div style="color:#3b82f6; font-weight:800;">BLUE HP</div>
      <div class="health-bar" id="blueHPBar"></div>
    </div>
  </div>

  <div class="battle-buttons">
    <button class="red" id="redWin">RED WIN</button>
    <button class="blue" id="blueWin">BLUE WIN</button>
  </div>

  <div id="finalWinText" class="big-win-text"></div>
</div>

<script>
  /* -----------------------------------
      챔피언 데이터
  ----------------------------------- */
  const champs = [
    { name: "웨펀마스터", img: "images/mwea.png" },
    { name: "버서커", img: "images/mbus.png" },
    { name: "소울브링어", img: "images/msou.png" },
    { name: "아수라", img: "images/msur.png" },
    { name: "넨마스터", img: "images/wnen.png" },
    { name: "스트라이커", img: "images/wstr.png" },
    { name: "스트리트파이터", img: "images/wspa.png" },
    { name: "그래플러", img: "images/wgra.png" },
    { name: "레인저(남)", img: "images/mran.png" },
    { name: "런처(남)", img: "images/mlun.png" },
    { name: "메카닉(남)", img: "images/mmec.png" },
    { name: "스핏파이어(남)", img: "images/mspi.png" },
    { name: "엘레멘탈마스터", img: "images/wele.png" },
    { name: "배틀메이지", img: "images/wbat.png" },
    { name: "마도학자", img: "images/wmad.png" },
    { name: "인챈트리스", img: "images/winc.png" },
    { name: "크루세이더(남)", img: "images/mcru.png" },
    { name: "인파이터(남)", img: "images/minp.png" },
    { name: "레인저(여)", img: "images/wran.png" },
    { name: "런처(여)", img: "images/wlun.png" },
    { name: "메카닉(여)", img: "images/wmec.png" },
    { name: "스핏파이어(여)", img: "images/wspi.png" },
    { name: "로그", img: "images/wlog.png" },
    { name: "쿠노이치", img: "images/wcun.png" },
    { name: "소드마스터", img: "images/wsod.png" },
    { name: "암제", img: "images/wamj.png" },
    { name: "검마", img: "images/wgum.png" },
    { name: "베가본드", img: "images/wbeg.png" },
    { name: "블레이드", img: "images/wbla.png" },
    { name: "뱅가드", img: "images/mban.png" },
    { name: "다크랜서", img: "images/mdar.png" },
    { name: "크루세이더(여)", img: "images/wcru.png" },
    { name: "이단심판관", img: "images/wida.png" },
    { name: "무녀", img: "images/wmun.png" },
    { name: "미스트리스", img: "images/wmis.png" },
    { name: "인파이터(여)", img: "images/winp.png" },
    { name: "와일드베인", img: "images/wwai.png" },
    { name: "윈드시어", img: "images/wwin.png" }
  ];

  const champPool = document.getElementById("champPool");

  // 밴픽 상태
  let maxBan = parseInt(document.getElementById("banCount").value, 10); // 기본 0
  let bluePick = [];
  let redPick = [];
  let blueBan = [];
  let redBan = [];
  let bannedSet = new Set();

  let phase = maxBan === 0 ? "pick" : "ban";  // 밴 0이면 바로 픽 단계
  let turn  = "red";                          // 레드가 먼저 시작

  // UI 요소
  const blueBanEl  = document.getElementById("blueBan");
  const redBanEl   = document.getElementById("redBan");
  const bluePickEl = document.getElementById("bluePick");
  const redPickEl  = document.getElementById("redPick");

  const statusEl   = document.getElementById("status");
  const draftArea  = document.getElementById("draftArea");
  const battleArea = document.getElementById("battleArea");

  const blueLineupEl = document.getElementById("blueLineup");
  const redLineupEl  = document.getElementById("redLineup");

  // 체력 상태
  let blueHP = 5;
  let redHP  = 5;

  /* -----------------------------------
      공통 함수
  ----------------------------------- */
  function getChamp(name) {
    return champs.find(c => c.name === name);
  }

  /* -----------------------------------
      챔피언 리스트 렌더링
  ----------------------------------- */
  function renderChamps() {
    champPool.innerHTML = "";
    champs.forEach(ch => {
      const div = document.createElement("div");
      div.className = "champion";
      div.dataset.name = ch.name;
      div.innerHTML = `<img src="${ch.img}" alt="${ch.name}"><div>${ch.name}</div>`;
      div.onclick = () => handlePick(ch.name);
      if (bannedSet.has(ch.name)) {
        div.classList.add("banned");
      }
      champPool.appendChild(div);
    });
  }

  renderChamps();
  updateStatus();

  /* -----------------------------------
      밴픽 처리 (중복 픽 허용, 밴된 건 픽 금지)
  ----------------------------------- */
  function handlePick(name) {
    // 이미 경기 넘어간 상태면 무시
    if (bluePick.length === 3 && redPick.length === 3) return;

    // 픽 단계에서 밴된 챔프는 선택 불가
    if (phase === "pick" && bannedSet.has(name)) return;

    if (phase === "ban") {
      if (maxBan === 0) return; // 안전장치

      if (turn === "blue") {
        if (blueBan.length >= maxBan) return;
        blueBan.push(name);
        blueBanEl.innerHTML += `<div class="chip ban">${name}</div>`;
      } else {
        if (redBan.length >= maxBan) return;
        redBan.push(name);
        redBanEl.innerHTML += `<div class="chip ban">${name}</div>`;
      }

      // 밴된 챔피언은 양 팀 모두 픽 불가
      bannedSet.add(name);
      markChampionBanned(name);

      // 턴 전환
      turn = (turn === "blue") ? "red" : "blue";

      // 밴이 모두 끝나면 픽 단계로, 레드부터 시작
      if (blueBan.length + redBan.length >= maxBan * 2) {
        phase = "pick";
        turn  = "red";
      }

    } else if (phase === "pick") {
      if (turn === "blue") {
        if (bluePick.length >= 3) return;
        bluePick.push(name);
        bluePickEl.innerHTML += `<div class="chip pick">${name}</div>`;
      } else {
        if (redPick.length >= 3) return;
        redPick.push(name);
        redPickEl.innerHTML += `<div class="chip pick">${name}</div>`;
      }

      // 턴 전환
      turn = (turn === "blue") ? "red" : "blue";
    }

    updateStatus();

    // 픽 3개씩 모두 완료 → 전투로
    if (phase === "pick" && bluePick.length === 3 && redPick.length === 3) {
      startBattle();
    }
  }

  function markChampionBanned(name) {
    const nodes = document.querySelectorAll(`.champion[data-name="${name}"]`);
    nodes.forEach(node => node.classList.add("banned"));
  }

  function updateStatus() {
    if (bluePick.length === 3 && redPick.length === 3) {
      statusEl.textContent = "모든 픽 완료";
      return;
    }
    const phaseText = phase === "ban" ? "BAN PHASE" : "PICK PHASE";
    const turnText  = turn === "blue" ? "블루팀" : "레드팀";
    statusEl.textContent = `${phaseText} - ${turnText} 선택`;
  }

  /* -----------------------------------
      전투 시작
  ----------------------------------- */
  function startBattle() {
    draftArea.style.display = "none";
    battleArea.style.display = "block";

    blueHP = parseInt(document.getElementById("blueHP").value, 10);
    redHP  = parseInt(document.getElementById("redHP").value, 10);

    renderHPBar("blue");
    renderHPBar("red");
    renderLineups();
  }

  function renderHPBar(team) {
    let container = document.getElementById(team === "blue" ? "blueHPBar" : "redHPBar");
    const hp = team === "blue" ? blueHP : redHP;
    container.innerHTML = "";

    for (let i = 0; i < hp; i++) {
      const bar = document.createElement("div");
      bar.className = "hp " + team;
      container.appendChild(bar);
    }
  }

  function renderLineups() {
    blueLineupEl.innerHTML = "";
    redLineupEl.innerHTML  = "";

    bluePick.forEach(name => {
      const champ = getChamp(name);
      if (!champ) return;
      const img = document.createElement("img");
      img.src = champ.img;
      img.alt = champ.name;
      blueLineupEl.appendChild(img);
    });

    redPick.forEach(name => {
      const champ = getChamp(name);
      if (!champ) return;
      const img = document.createElement("img");
      img.src = champ.img;
      img.alt = champ.name;
      redLineupEl.appendChild(img);
    });
  }

  /* -----------------------------------
      전투 로직
  ----------------------------------- */
  const finalText = document.getElementById("finalWinText");

  document.getElementById("blueWin").onclick = () => {
    if (blueHP <= 0 || redHP <= 0) return;
    redHP--;
    if (redHP < 0) redHP = 0;
    renderHPBar("red");
    checkWinner();
  };

  document.getElementById("redWin").onclick = () => {
    if (blueHP <= 0 || redHP <= 0) return;
    blueHP--;
    if (blueHP < 0) blueHP = 0;
    renderHPBar("blue");
    checkWinner();
  };

  function checkWinner() {
    if (blueHP <= 0 && redHP <= 0) {
      finalText.textContent = "DRAW";
    } else if (blueHP <= 0) {
      finalText.textContent = "RED WIN!";
    } else if (redHP <= 0) {
      finalText.textContent = "BLUE WIN!";
    }
  }

  /* -----------------------------------
      옵션/버튼
  ----------------------------------- */
  document.getElementById("banCount").onchange = (e) => {
    const newVal = parseInt(e.target.value, 10);
    maxBan = newVal;

    // 아무 것도 진행되지 않은 상태에서 밴 수를 0으로 바꾸면 바로 픽 단계 + 레드 선픽
    if (blueBan.length === 0 && redBan.length === 0 && bluePick.length === 0 && redPick.length === 0) {
      phase = (maxBan === 0) ? "pick" : "ban";
      turn  = "red";
    }

    updateStatus();
  };

  document.getElementById("resetBtn").onclick = () => {
    location.reload();
  };

  document.getElementById("shuffleBtn").onclick = () => {
    champs.sort(() => Math.random() - 0.5);
    renderChamps();
  };
</script>

</body>
</html>
